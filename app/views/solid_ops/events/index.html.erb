<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>SolidOps</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 16px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; }
      label { font-size: 12px; display: block; margin-bottom: 4px; opacity: 0.8; }
      input, select { padding: 8px; border: 1px solid #ddd; border-radius: 10px; min-width: 220px; }
      button { padding: 9px 14px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
      table { width: 100%; border-collapse: collapse; margin-top: 16px; }
      th, td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; vertical-align: top; }
      th { font-size: 12px; opacity: 0.7; }
      .pill { display: inline-block; padding: 3px 9px; border-radius: 999px; border: 1px solid #eee; font-size: 12px; }
      a { color: inherit; }
      .muted { opacity: 0.7; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New"; font-size: 12px; }
    </style>
  </head>
  <body>
    <h1>SolidOps</h1>

    <form method="get" action="<%= solid_ops.events_path %>">
      <div class="row">
        <div>
          <label>Event type</label>
          <select name="event_type">
            <option value=""></option>
            <% ["cable.broadcast","job.enqueue","job.perform_start","job.perform","cache.read","cache.write","cache.delete"].each do |t| %>
              <option value="<%= t %>" <%= "selected" if params[:event_type].to_s == t %>><%= t %></option>
            <% end %>
          </select>
        </div>

        <div>
          <label>Correlation ID</label>
          <input name="correlation_id" value="<%= params[:correlation_id].to_s %>">
        </div>

        <div>
          <label>Request ID</label>
          <input name="request_id" value="<%= params[:request_id].to_s %>">
        </div>

        <div>
          <label>Tenant</label>
          <input name="tenant_id" value="<%= params[:tenant_id].to_s %>">
        </div>

        <div>
          <label>Name contains</label>
          <input name="q" value="<%= params[:q].to_s %>">
        </div>

        <div>
          <label>Limit</label>
          <input name="limit" value="<%= params[:limit].presence || 200 %>">
        </div>

        <div>
          <button type="submit">Filter</button>
          <a href="<%= solid_ops.root_path %>"><button type="button">Clear</button></a>
        </div>
      </div>
    </form>

    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Type</th>
          <th>Name</th>
          <th>Duration</th>
          <th>Correlation</th>
          <th>Request</th>
          <th>Tenant</th>
        </tr>
      </thead>
      <tbody>
        <% @events.each do |e| %>
          <tr>
            <td class="mono"><a href="<%= solid_ops.event_path(e.id) %>"><%= e.occurred_at&.strftime("%Y-%m-%d %H:%M:%S.%L") %></a></td>
            <td><span class="pill"><%= e.event_type %></span></td>
            <td class="mono"><%= e.name %></td>
            <td class="mono muted"><%= e.duration_ms ? format("%.2fms", e.duration_ms) : "" %></td>
            <td class="mono muted"><%= e.correlation_id %></td>
            <td class="mono muted"><%= e.request_id %></td>
            <td class="mono muted"><%= e.tenant_id %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </body>
</html>
